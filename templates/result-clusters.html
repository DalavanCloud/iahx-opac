<div class="resultServices">
    
    <div class="mySelection filters" id="filters">
        <h3>{{ texts.YOUR_SELECTION }} (<span class="my_selection_count">0</span>)</h3>
        <ul>
            <li><a href="javascript:list_bookmark();" title="{{ texts.SELECTION_LIST_REGISTERS }}">{{ texts.SELECTION_LIST_REGISTERS }}</a></li>
             <li><a href="javascript:clean_bookmark('{{ texts.CONFIRM_CLEAR_LIST }}');" title="{{ texts.SELECTION_CLEAR_LIST }}">{{ texts.SELECTION_CLEAR_LIST }}</a></li>
        </ul>
    </div>

    {% if filters_formatted|length > 0 %}
        <div class="filters" id="filters">
            <h3>{{ texts.SELECTED_FILTERS }}</h3>
            <ul>
                {% for cluster, items in filters_formatted %}
                    {% set cluster_label = 'REFINE_' ~ cluster %}

                    <li class="filter">{{ attribute(texts.RESULT, cluster_label) }} 
                        <ul>
                            {% for item in items %}
                                {% set item_value = cluster ~ '_' ~ item|replace(" ", "_") ~ '' %}

                                <li>
                                    {{ item }} <a href="javascript:remove_filter('{{ item_value }}')" title="Remover cluster: {{ item }}">(remover)</a>
                                </li>
                            {% endfor %}
                        </ul>
                {% endfor %}
            </ul>
        </div>
    {% endif %}


    <div class="refineSearch" id="refineSearch">

        <div class="bContent" id="refine_facet">

            <form action="" id="form_clusters" method="GET">

                {% for key, value in params %}
                    {% if key != "filter"  %}
                        {% if key == "from" or key == "page" %}
                            <input type="hidden" name="{{ key }}" value="1">
                        {% else %}
                            <input type="hidden" name="{{ key }}" value="{{ value }}">
                        {% endif %}
                    {% endif %}
                {% endfor %}

                {% for name, cluster in clusters if cluster|length > 0 %}

                    {% set cluster_label = 'REFINE_' ~ name %}
                    
                    <div id="{{ name }}">
                        <a href="javascript:toggle_cluster('{{ name }}');" title="{{ name }}">
                            <strong>
                                {{ attribute(texts.RESULT, cluster_label) }}
                            </strong>
                        </a>

                        <a href="#" onclick="javascript:open_chart(this,'{{ attribute(texts.RESULT, cluster_label) }}','{{ name }}')" class="fancybox_iframe">
                            <img src="{{ constant("STATIC_URL") }}image/common/chart.gif" alt="{{ texts.CHART }}">
                        </a>

                        <ul id="ul_{{ name }}">
                            {% for item in cluster %}
                                <li>
                                    <input type="checkbox" name="filter[{{ name }}][]" value='{{ item.0 }}' id="{{ name }}_{{ item.0|replace({' ': '_'}) }}"
                                    {% for filter_name, filter in filters if filter_name == name %}
                                        {% if item.0 in filter %}checked="true"{% endif %}
                                    {% endfor %}
                                    >
                                    <a href="javascript: add_filter('{{ name }}_{{ item.0|replace({' ': '_'}) }}');" title="">{{ item.0 }}</a> ({{ item.1 }})
                                </li>
                            {% endfor %}
                            <input type="submit" value="filtrar">
                        </ul>
                    </div>
                {% endfor %}
            </form>
        </div>
    </div>
</div>